
<!-- Main Content: Weekly Planner -->
<main class="flex flex-col flex-grow relative z-10">
  <!-- Top Decoration -->
  <div class="absolute top-0 left-0 right-0 h-64 bg-gradient-to-b from-indigo-900/10 to-transparent pointer-events-none"></div>

  <!-- AI Organizing Overlay -->
  @if(taskService.isOrganizing()) {
    <div class="absolute inset-0 bg-planner-bg/60 backdrop-blur-sm flex flex-col items-center justify-center z-50 animate-pop-in">
       <svg class="animate-spin h-8 w-8 text-indigo-400 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <h3 class="text-lg font-bold text-white tracking-wide">Magically Organizing...</h3>
        <p class="text-sm text-planner-text-dim mt-1">Please wait while the AI builds your optimal week.</p>
    </div>
  }

  <!-- Week Navigation -->
  <header class="flex items-center justify-between px-8 py-6 flex-shrink-0 relative z-20">
    <button (click)="taskService.navigateWeek(-1)" class="flex items-center gap-2 px-4 py-2 rounded-full bg-planner-surface hover:bg-planner-card border border-white/5 hover:border-white/10 transition-all text-sm font-semibold text-planner-text-dim hover:text-white group">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 group-hover:-translate-x-0.5 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
      PREV
    </button>
    
    <div class="flex flex-col items-center">
      <h2 class="text-3xl font-bold tracking-tight text-white">
        Week {{ taskService.currentWeekKey().split('-W')[1] }}
      </h2>
      <div class="flex items-center gap-2 mt-1">
        <span class="text-base font-medium text-planner-text-dim">{{ taskService.weekDateRange() }}</span>
      </div>
    </div>
    
    <button (click)="taskService.navigateWeek(1)" class="flex items-center gap-2 px-4 py-2 rounded-full bg-planner-surface hover:bg-planner-card border border-white/5 hover:border-white/10 transition-all text-sm font-semibold text-planner-text-dim hover:text-white group">
      NEXT
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 group-hover:translate-x-0.5 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
    </button>
  </header>

  <!-- Calendar Grid -->
  <div class="flex-grow px-2 pb-6 min-h-0 overflow-x-auto custom-scrollbar">
    <!-- Days Columns -->
    <div class="flex gap-0 h-full min-w-max">
      @for (day of taskService.daysOfWeek; track day; let i = $index) {
        <div class="w-[280px] flex-shrink-0 h-full">
            <app-day-column [day]="day" [dayIndex]="i"></app-day-column>
        </div>
      }
    </div>
  </div>
</main>